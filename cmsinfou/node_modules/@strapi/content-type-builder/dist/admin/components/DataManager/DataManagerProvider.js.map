{"version":3,"file":"DataManagerProvider.js","sources":["../../../../admin/src/components/DataManager/DataManagerProvider.tsx"],"sourcesContent":["import * as React from 'react';\n\nimport {\n  useTracking,\n  useStrapiApp,\n  useNotification,\n  useAppInfo,\n  useFetchClient,\n  useAuth,\n  adminApi,\n  useGuidedTour,\n  GUIDED_TOUR_REQUIRED_ACTIONS,\n} from '@strapi/admin/strapi-admin';\nimport groupBy from 'lodash/groupBy';\nimport isEqual from 'lodash/isEqual';\nimport mapValues from 'lodash/mapValues';\nimport { useIntl } from 'react-intl';\nimport { useSelector, useDispatch } from 'react-redux';\n\nimport { getTrad } from '../../utils/getTrad';\nimport { useAutoReloadOverlayBlocker } from '../AutoReloadOverlayBlocker';\nimport { useFormModalNavigation } from '../FormModalNavigation/useFormModalNavigation';\n\nimport { DataManagerContext, type DataManagerContextValue } from './DataManagerContext';\nimport { actions, initialState, type State } from './reducer';\nimport { useServerRestartWatcher } from './useServerRestartWatcher';\nimport { sortContentType, stateToRequestData } from './utils/cleanData';\nimport { retrieveComponentsThatHaveComponents } from './utils/retrieveComponentsThatHaveComponents';\nimport { retrieveNestedComponents } from './utils/retrieveNestedComponents';\nimport { retrieveSpecificInfoFromComponents } from './utils/retrieveSpecificInfoFromComponents';\n\nimport type { ContentTypes, ContentType, Components } from '../../types';\nimport type { FormAPI } from '../../utils/formAPI';\nimport type { Internal } from '@strapi/types';\n\ninterface DataManagerProviderProps {\n  children: React.ReactNode;\n}\n\nconst selectState = (state: Record<string, unknown>) =>\n  (state['content-type-builder_dataManagerProvider'] || initialState) as State;\n\nconst DataManagerProvider = ({ children }: DataManagerProviderProps) => {\n  const dispatch = useDispatch();\n  const state = useSelector(selectState);\n  const dispatchGuidedTour = useGuidedTour('DataManagerProvider', (s) => s.dispatch);\n\n  const {\n    components,\n    contentTypes,\n    reservedNames,\n    initialComponents,\n    initialContentTypes,\n    isLoading,\n  } = state.current;\n\n  const { toggleNotification } = useNotification();\n  const { lockAppWithAutoreload, unlockAppWithAutoreload } = useAutoReloadOverlayBlocker();\n  const serverRestartWatcher = useServerRestartWatcher();\n\n  const getPlugin = useStrapiApp('DataManagerProvider', (state) => state.getPlugin);\n  const plugin = getPlugin('content-type-builder');\n  const autoReload = useAppInfo('DataManagerProvider', (state) => state.autoReload);\n  const { formatMessage } = useIntl();\n  const { trackUsage } = useTracking();\n  const refetchPermissions = useAuth('DataManagerProvider', (state) => state.refetchPermissions);\n  const { onCloseModal } = useFormModalNavigation();\n\n  const [isSaving, setIsSaving] = React.useState(false);\n\n  const isModified = React.useMemo(() => {\n    return !(isEqual(components, initialComponents) && isEqual(contentTypes, initialContentTypes));\n  }, [components, contentTypes, initialComponents, initialContentTypes]);\n\n  const fetchClient = useFetchClient();\n\n  const isInDevelopmentMode = autoReload;\n\n  const getDataRef = React.useRef<any>();\n\n  getDataRef.current = async () => {\n    try {\n      const [schemaResponse, reservedNamesResponse] = await Promise.all([\n        fetchClient.get(`/content-type-builder/schema`),\n        fetchClient.get(`/content-type-builder/reserved-names`),\n      ]);\n\n      const { components, contentTypes } = schemaResponse.data.data;\n\n      dispatch(\n        actions.init({\n          components: mapValues(components, (component) => ({\n            ...component,\n            status: 'UNCHANGED',\n          })) as Components,\n          contentTypes: mapValues(contentTypes, (contentType) => ({\n            ...contentType,\n            status: 'UNCHANGED',\n          })) as ContentTypes,\n          reservedNames: reservedNamesResponse.data,\n        })\n      );\n\n      dispatch(actions.clearHistory());\n    } catch (err) {\n      console.error({ err });\n      toggleNotification({\n        type: 'danger',\n        message: formatMessage({ id: 'notification.error', defaultMessage: 'An error occurred' }),\n      });\n    }\n  };\n\n  React.useEffect(() => {\n    getDataRef.current();\n\n    return () => {\n      // Reload the plugin so the cycle is new again\n      dispatch(actions.reloadPlugin());\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  React.useEffect(() => {\n    if (!autoReload) {\n      toggleNotification({\n        type: 'info',\n        message: formatMessage({ id: getTrad('notification.info.autoreaload-disable') }),\n      });\n    }\n  }, [autoReload, toggleNotification, formatMessage]);\n\n  const getAllComponentsThatHaveAComponentInTheirAttributes = (components: Components) => {\n    const composWithCompos = retrieveComponentsThatHaveComponents(components);\n\n    return composWithCompos;\n  };\n\n  const getAllNestedComponents = (components: Components) => {\n    const appNestedCompo = retrieveNestedComponents(components);\n\n    return appNestedCompo;\n  };\n\n  const updatePermissions = async () => {\n    await refetchPermissions();\n  };\n\n  const saveSchema = async () => {\n    setIsSaving(true);\n\n    const PluginForms = plugin?.apis?.forms as FormAPI;\n\n    const mutatedCTs = Object.entries(state.current.contentTypes).reduce(\n      (acc, [uid, contentType]) => {\n        acc[uid] = PluginForms.mutateContentTypeSchema(\n          contentType,\n          initialContentTypes[uid]\n        ) as ContentType;\n\n        return acc;\n      },\n      {} as ContentTypes\n    );\n\n    const { requestData, trackingEventProperties } = stateToRequestData({\n      components: state.current.components,\n      contentTypes: mutatedCTs,\n    });\n\n    const isSendingContentTypes = Object.keys(state.current.contentTypes).length > 0;\n\n    lockAppWithAutoreload();\n\n    try {\n      await fetchClient.post(`/content-type-builder/update-schema`, { data: requestData });\n\n      if (isSendingContentTypes) {\n        trackUsage('didCreateGuidedTourCollectionType');\n      }\n\n      // Make sure the server has restarted\n      await serverRestartWatcher();\n      // refetch and update initial state after the data has been saved\n      await getDataRef.current();\n      // Update the app's permissions\n      await updatePermissions();\n    } catch (err) {\n      console.error({ err });\n      toggleNotification({\n        type: 'danger',\n        message: formatMessage({ id: 'notification.error', defaultMessage: 'An error occurred' }),\n      });\n\n      trackUsage('didUpdateCTBSchema', { ...trackingEventProperties, success: false });\n    } finally {\n      setIsSaving(false);\n      unlockAppWithAutoreload();\n\n      dispatch(adminApi.util.invalidateTags(['GuidedTourMeta', 'HomepageKeyStatistics']));\n      dispatchGuidedTour({\n        type: 'set_completed_actions',\n        payload: [GUIDED_TOUR_REQUIRED_ACTIONS.contentTypeBuilder.createSchema],\n      });\n\n      trackUsage('didUpdateCTBSchema', { ...trackingEventProperties, success: true });\n    }\n  };\n\n  const componentsThatHaveOtherComponentInTheirAttributes = React.useMemo(() => {\n    return getAllComponentsThatHaveAComponentInTheirAttributes(components);\n  }, [components]);\n\n  const nestedComponents = React.useMemo(() => {\n    return getAllNestedComponents(components);\n  }, [components]);\n\n  const allComponentsCategories = React.useMemo(() => {\n    return retrieveSpecificInfoFromComponents(components, ['category']);\n  }, [components]);\n\n  const componentsGroupedByCategory = React.useMemo(() => {\n    return groupBy(components, 'category');\n  }, [components]);\n\n  const sortedContentTypesList = React.useMemo(() => {\n    return sortContentType(contentTypes);\n  }, [contentTypes]);\n\n  const context: DataManagerContextValue = {\n    componentsThatHaveOtherComponentInTheirAttributes,\n    nestedComponents,\n    saveSchema,\n    reservedNames,\n    components,\n    contentTypes,\n    initialComponents,\n    initialContentTypes,\n    isSaving,\n    isModified,\n    isInDevelopmentMode,\n    allComponentsCategories,\n    componentsGroupedByCategory,\n    sortedContentTypesList,\n    isLoading,\n    addAttribute(payload) {\n      dispatch(actions.addAttribute(payload));\n    },\n    editAttribute(payload) {\n      dispatch(actions.editAttribute(payload));\n    },\n    addCustomFieldAttribute(payload) {\n      dispatch(actions.addCustomFieldAttribute(payload));\n    },\n    editCustomFieldAttribute(payload) {\n      dispatch(actions.editCustomFieldAttribute(payload));\n    },\n    addCreatedComponentToDynamicZone(payload) {\n      dispatch(actions.addCreatedComponentToDynamicZone(payload));\n    },\n    createSchema(payload) {\n      dispatch(actions.createSchema(payload));\n    },\n    createComponentSchema({ data, uid, componentCategory }) {\n      dispatch(actions.createComponentSchema({ data, uid, componentCategory }));\n    },\n    changeDynamicZoneComponents({ forTarget, targetUid, dynamicZoneTarget, newComponents }) {\n      dispatch(\n        actions.changeDynamicZoneComponents({\n          forTarget,\n          targetUid,\n          dynamicZoneTarget,\n          newComponents,\n        })\n      );\n    },\n    removeAttribute(payload) {\n      if (payload.forTarget === 'contentType') {\n        trackUsage('willDeleteFieldOfContentType');\n      }\n\n      dispatch(actions.removeField(payload));\n    },\n    removeComponentFromDynamicZone(payload) {\n      dispatch(actions.removeComponentFromDynamicZone(payload));\n    },\n    deleteComponent(uid: Internal.UID.Component) {\n      const userConfirm = window.confirm(\n        formatMessage({\n          id: getTrad(`popUpWarning.bodyMessage.component.delete`),\n        })\n      );\n\n      if (userConfirm) {\n        onCloseModal();\n\n        dispatch(actions.deleteComponent(uid));\n      }\n    },\n    deleteContentType(uid: Internal.UID.ContentType) {\n      const userConfirm = window.confirm(\n        formatMessage({\n          id: getTrad(`popUpWarning.bodyMessage.contentType.delete`),\n        })\n      );\n\n      if (userConfirm) {\n        onCloseModal();\n\n        dispatch(actions.deleteContentType(uid));\n      }\n    },\n\n    updateComponentSchema({ data, componentUID }) {\n      dispatch(\n        actions.updateComponentSchema({\n          data,\n          uid: componentUID,\n        })\n      );\n    },\n\n    updateComponentUid({ componentUID, newComponentUID }) {\n      dispatch(\n        actions.updateComponentUid({\n          uid: componentUID,\n          newComponentUID,\n        })\n      );\n    },\n\n    updateSchema(args) {\n      dispatch(actions.updateSchema(args));\n    },\n\n    moveAttribute(args) {\n      dispatch(actions.moveAttribute(args));\n    },\n\n    applyChange(args) {\n      dispatch(actions.applyChange(args));\n    },\n\n    history: {\n      undo() {\n        dispatch(actions.undo());\n      },\n\n      redo() {\n        dispatch(actions.redo());\n      },\n\n      discardAllChanges() {\n        dispatch(actions.discardAll());\n      },\n\n      canUndo: state.past.length > 0,\n      canRedo: state.future.length > 0,\n      canDiscardAll: isModified,\n    },\n  };\n\n  return <DataManagerContext.Provider value={context}>{children}</DataManagerContext.Provider>;\n};\n\n// eslint-disable-next-line import/no-default-export\nexport default DataManagerProvider;\n"],"names":["selectState","state","initialState","DataManagerProvider","children","dispatch","useDispatch","useSelector","dispatchGuidedTour","useGuidedTour","s","components","contentTypes","reservedNames","initialComponents","initialContentTypes","isLoading","current","toggleNotification","useNotification","lockAppWithAutoreload","unlockAppWithAutoreload","useAutoReloadOverlayBlocker","serverRestartWatcher","useServerRestartWatcher","getPlugin","useStrapiApp","plugin","autoReload","useAppInfo","formatMessage","useIntl","trackUsage","useTracking","refetchPermissions","useAuth","onCloseModal","useFormModalNavigation","isSaving","setIsSaving","React","useState","isModified","useMemo","isEqual","fetchClient","useFetchClient","isInDevelopmentMode","getDataRef","useRef","schemaResponse","reservedNamesResponse","Promise","all","get","data","actions","init","mapValues","component","status","contentType","clearHistory","err","console","error","type","message","id","defaultMessage","useEffect","reloadPlugin","getTrad","getAllComponentsThatHaveAComponentInTheirAttributes","composWithCompos","retrieveComponentsThatHaveComponents","getAllNestedComponents","appNestedCompo","retrieveNestedComponents","updatePermissions","saveSchema","PluginForms","apis","forms","mutatedCTs","Object","entries","reduce","acc","uid","mutateContentTypeSchema","requestData","trackingEventProperties","stateToRequestData","isSendingContentTypes","keys","length","post","success","adminApi","util","invalidateTags","payload","GUIDED_TOUR_REQUIRED_ACTIONS","contentTypeBuilder","createSchema","componentsThatHaveOtherComponentInTheirAttributes","nestedComponents","allComponentsCategories","retrieveSpecificInfoFromComponents","componentsGroupedByCategory","groupBy","sortedContentTypesList","sortContentType","context","addAttribute","editAttribute","addCustomFieldAttribute","editCustomFieldAttribute","addCreatedComponentToDynamicZone","createComponentSchema","componentCategory","changeDynamicZoneComponents","forTarget","targetUid","dynamicZoneTarget","newComponents","removeAttribute","removeField","removeComponentFromDynamicZone","deleteComponent","userConfirm","window","confirm","deleteContentType","updateComponentSchema","componentUID","updateComponentUid","newComponentUID","updateSchema","args","moveAttribute","applyChange","history","undo","redo","discardAllChanges","discardAll","canUndo","past","canRedo","future","canDiscardAll","_jsx","DataManagerContext","Provider","value"],"mappings":"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"}