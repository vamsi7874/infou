{"version":3,"file":"index.mjs","sources":["../../admin/src/index.ts"],"sourcesContent":["import { CheckCircle, Feather, Pencil, PuzzlePiece } from '@strapi/icons';\n\nimport { PLUGIN_ID } from './constants/plugin';\nimport { ContentManagerPlugin } from './content-manager';\nimport { historyAdmin } from './history';\nimport { reducer } from './modules/reducers';\nimport { previewAdmin } from './preview';\nimport { routes } from './router';\nimport { prefixPluginTranslations } from './utils/translations';\n\nimport type { WidgetArgs } from '@strapi/admin/strapi-admin';\n\n// NOTE: we have to preload it to ensure chunks will have it available as global\nimport 'prismjs';\n\n// eslint-disable-next-line import/no-default-export\nexport default {\n  register(app: any) {\n    const cm = new ContentManagerPlugin();\n\n    app.addReducers({\n      [PLUGIN_ID]: reducer,\n    });\n\n    app.addMenuLink({\n      to: PLUGIN_ID,\n      icon: Feather,\n      intlLabel: {\n        id: `content-manager.plugin.name`,\n        defaultMessage: 'Content Manager',\n      },\n      permissions: [],\n      position: 1,\n    });\n\n    app.router.addRoute({\n      path: 'content-manager/*',\n      lazy: async () => {\n        const { Layout } = await import('./layout');\n\n        return {\n          Component: Layout,\n        };\n      },\n      children: routes,\n    });\n\n    app.registerPlugin(cm.config);\n\n    app.widgets.register((widgets: WidgetArgs[]) => {\n      const lastEditedWidget: WidgetArgs = {\n        icon: Pencil,\n        title: {\n          id: `${PLUGIN_ID}.widget.last-edited.title`,\n          defaultMessage: 'Last edited entries',\n        },\n        component: async () => {\n          const { LastEditedWidget } = await import('./components/Widgets');\n          return LastEditedWidget;\n        },\n        pluginId: PLUGIN_ID,\n        id: 'last-edited-entries',\n        permissions: [{ action: 'plugin::content-manager.explorer.read' }],\n      };\n      const lastPublishedWidget: WidgetArgs = {\n        icon: CheckCircle,\n        title: {\n          id: `${PLUGIN_ID}.widget.last-published.title`,\n          defaultMessage: 'Last published entries',\n        },\n        component: async () => {\n          const { LastPublishedWidget } = await import('./components/Widgets');\n          return LastPublishedWidget;\n        },\n        pluginId: PLUGIN_ID,\n        id: 'last-published-entries',\n        permissions: [{ action: 'plugin::content-manager.explorer.read' }],\n      };\n      const entriesWidget: WidgetArgs = {\n        icon: PuzzlePiece,\n        title: {\n          id: `${PLUGIN_ID}.widget.chart-entries.title`,\n          defaultMessage: 'Entries',\n        },\n        component: async () => {\n          const { ChartEntriesWidget } = await import('./components/Widgets');\n          return ChartEntriesWidget;\n        },\n        pluginId: PLUGIN_ID,\n        id: 'chart-entries',\n        permissions: [{ action: 'plugin::content-manager.explorer.read' }],\n      };\n\n      const profileInfoIndex = widgets.findIndex(\n        (widget) => widget.id === 'profile-info' && widget.pluginId === 'admin'\n      );\n\n      // Insert chart-entries after the profile-info widget\n      if (profileInfoIndex !== -1) {\n        const newWidgets: WidgetArgs[] = [...widgets];\n        newWidgets.splice(profileInfoIndex + 1, 0, entriesWidget);\n        return [lastEditedWidget, lastPublishedWidget, ...newWidgets];\n      }\n\n      // Fallback: add to the end if the target widget aren't found\n      return [lastEditedWidget, lastPublishedWidget, ...widgets, entriesWidget];\n    });\n  },\n  bootstrap(app: any) {\n    if (typeof historyAdmin.bootstrap === 'function') {\n      historyAdmin.bootstrap(app);\n    }\n    if (typeof previewAdmin.bootstrap === 'function') {\n      previewAdmin.bootstrap(app);\n    }\n  },\n  async registerTrads({ locales }: { locales: string[] }) {\n    const importedTrads = await Promise.all(\n      locales.map((locale) => {\n        return import(`./translations/${locale}.json`)\n          .then(({ default: data }) => {\n            return {\n              data: prefixPluginTranslations(data, PLUGIN_ID),\n              locale,\n            };\n          })\n          .catch(() => {\n            return {\n              data: {},\n              locale,\n            };\n          });\n      })\n    );\n\n    return Promise.resolve(importedTrads);\n  },\n};\n\nexport * from './exports';\n"],"names":["register","app","cm","ContentManagerPlugin","addReducers","PLUGIN_ID","reducer","addMenuLink","to","icon","Feather","intlLabel","id","defaultMessage","permissions","position","router","addRoute","path","lazy","Layout","Component","children","routes","registerPlugin","config","widgets","lastEditedWidget","Pencil","title","component","LastEditedWidget","pluginId","action","lastPublishedWidget","CheckCircle","LastPublishedWidget","entriesWidget","PuzzlePiece","ChartEntriesWidget","profileInfoIndex","findIndex","widget","newWidgets","splice","bootstrap","historyAdmin","previewAdmin","registerTrads","locales","importedTrads","Promise","all","map","locale","then","default","data","prefixPluginTranslations","catch","resolve"],"mappings":"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"}